<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚¯ã‚¤ã‚ºç”»é¢</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background: #f0f0f0;
      text-align: center;
    }
    #nameInputArea {
      margin-bottom: 20px;
    }
    #nameInput {
      padding: 8px;
      font-size: 1.2em;
    }
    #quizArea {
      display: none;
    }
    .question {
      font-size: 1.6em;
      margin-bottom: 20px;
      font-weight: 700;
    }
    .choices button {
      display: block;
      width: 60%;
      margin: 10px auto;
      font-size: 1.3em;
      padding: 12px;
      cursor: pointer;
      border-radius: 5px;
      border: 1px solid #444;
      background-color: #fff;
      transition: background-color 0.3s;
    }
    .choices button:hover:not(:disabled) {
      background-color: #e0e0e0;
    }
    .choices button:disabled {
      background-color: #ccc;
      cursor: default;
    }
    #standby {
      font-size: 1.4em;
      margin-top: 20px;
      color: #666;
      display: none;
    }
    #result {
      font-size: 1.6em;
      margin-top: 30px;
      font-weight: 700;
    }
  </style>
</head>
<body>
  <h1>ã‚¯ã‚¤ã‚ºå¤§ä¼š</h1>

  <div id="nameInputArea">
    <p>åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š</p>
    <input type="text" id="nameInput" maxlength="20" />
    <button id="registerBtn">ç™»éŒ²</button>
  </div>

  <div id="quizArea">
    <div class="question" id="questionText"></div>
    <div class="choices" id="choices"></div>
    <div id="standby">å›ç­”ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚ã‚¹ã‚¿ãƒ³ãƒã‚¤ä¸­...</div>
    <div id="result"></div>
  </div>

  <script>
    (() => {
      const socket = io();

      let userName = '';
      let questionStartTime = 0;

      const nameInputArea = document.getElementById('nameInputArea');
      const nameInput = document.getElementById('nameInput');
      const registerBtn = document.getElementById('registerBtn');
      const quizArea = document.getElementById('quizArea');
      const questionText = document.getElementById('questionText');
      const choicesDiv = document.getElementById('choices');
      const standbyDiv = document.getElementById('standby');
      const resultDiv = document.getElementById('result');

      function enableChoices(enabled) {
        const buttons = choicesDiv.querySelectorAll('button');
        buttons.forEach(btn => {
          btn.disabled = !enabled;
        });
      }

      registerBtn.addEventListener('click', () => {
        const val = nameInput.value.trim();
        if (!val) {
          alert('åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
          return;
        }
        userName = val;
        nameInputArea.style.display = 'none';
        quizArea.style.display = 'block';
      });

      // ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã®å•é¡Œå‡ºé¡Œ
      socket.on('question', data => {
        // åˆæœŸåŒ–
        resultDiv.textContent = '';
        standbyDiv.style.display = 'none';

        if (!data || !data.question || !Array.isArray(data.choices)) {
          questionText.textContent = 'å•é¡Œãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“';
          choicesDiv.innerHTML = '';
          return;
        }

        questionText.textContent = data.question;

        // é¸æŠè‚¢ãƒœã‚¿ãƒ³ç”Ÿæˆ
        choicesDiv.innerHTML = '';
        data.choices.forEach(choice => {
          const btn = document.createElement('button');
          btn.textContent = choice;
          btn.onclick = () => {
            const elapsed = Date.now() - questionStartTime;
            socket.emit('answer', { name: userName, choice, elapsed });
            enableChoices(false);
            standbyDiv.style.display = 'block';
          };
          choicesDiv.appendChild(btn);
        });
        enableChoices(true);
        questionStartTime = Date.now();
      });

      // å›ç­”å—ä»˜çµ‚äº†ãªã©ã®åˆå›³
      socket.on('go', () => {
        // å•é¡Œå—ä¿¡ã‚’å¾…ã¤ã‚¹ã‚¿ãƒ³ãƒã‚¤çŠ¶æ…‹ã«ã™ã‚‹
        questionText.textContent = 'å•é¡Œã‚’å¾…ã£ã¦ã„ã¾ã™...';
        choicesDiv.innerHTML = '';
        standbyDiv.style.display = 'none';
        resultDiv.textContent = '';
      });

      // æ­£è§£ç™ºè¡¨
      socket.on('result', data => {
        if (!data || !data.correctAnswer) return;

        const userAnswer = data.userAnswer; // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒé€ã£ãŸå›ç­”ï¼ˆã‚ã‚Œã°ï¼‰
        const correctAnswer = data.correctAnswer;

        // çµæœè¡¨ç¤º
        if (userAnswer === undefined) {
          resultDiv.textContent = `æ­£è§£ã¯ã€Œ${correctAnswer}ã€ã§ã™`;
        } else if (userAnswer === correctAnswer) {
          resultDiv.textContent = 'æ­£è§£ã§ã™ï¼ğŸ‰';
          resultDiv.style.color = 'green';
        } else {
          resultDiv.textContent = `ä¸æ­£è§£ã§ã™... æ­£è§£ã¯ã€Œ${correctAnswer}ã€`;
          resultDiv.style.color = 'red';
        }
        standbyDiv.style.display = 'none';
        enableChoices(false);
      });

      // æ¥ç¶šã‚¨ãƒ©ãƒ¼ãªã©ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆç°¡æ˜“ç‰ˆï¼‰
      socket.on('connect_error', () => {
        alert('ã‚µãƒ¼ãƒãƒ¼ã¸ã®æ¥ç¶šã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦ãã ã•ã„ã€‚');
      });
    })();
  </script>
</body>
</html>
